!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).tus=e()}(function(){return function o(s,i,n){function l(t,e){if(!i[t]){if(!s[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(a)return a(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}r=i[t]={exports:{}},s[t][0].call(r.exports,function(e){return l(s[t][1][e]||e)},r,r.exports,o,s,i,n)}return i[t].exports}for(var a="function"==typeof require&&require,e=0;e<n.length;e++)l(n[e]);return l}({1:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var o=l(e("./isReactNative.js")),s=l(e("./uriToBlob.js")),i=l(e("./sources/FileSource.js")),n=l(e("./sources/StreamSource.js"));function l(e){return e&&e.__esModule?e:{default:e}}r.default=class{async openFile(e,t){if((0,o.default)()&&e&&void 0!==e.uri)try{var r=await(0,s.default)(e.uri);return new i.default(r)}catch(e){throw new Error("tus: cannot fetch `file.uri` as Blob, make sure the uri is correct and accessible. "+e)}return"function"==typeof e.slice&&void 0!==e.size?Promise.resolve(new i.default(e)):"function"==typeof e.read?(t=Number(t),Number.isFinite(t)?Promise.resolve(new n.default(e,t)):Promise.reject(new Error("cannot create source for stream without a finite value for the `chunkSize` option"))):Promise.reject(new Error("source object may only be an instance of File, Blob, or Reader in this environment"))}}},{"./isReactNative.js":5,"./sources/FileSource.js":6,"./sources/StreamSource.js":7,"./uriToBlob.js":10}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t){if((0,o.default)())return Promise.resolve(function(e,t){var r=e.exif?function(t){let r=0;if(0!==t.length)for(let e=0;e<t.length;e++){var o=t.charCodeAt(e);r=(r<<5)-r+o,r&=r}return r}(JSON.stringify(e.exif)):"noexif";return["tus-rn",e.name||"noname",e.size||"nosize",r,t.endpoint].join("/")}(e,t));return Promise.resolve(["tus-br",e.name,e.type,e.size,e.lastModified,t.endpoint].join("-"))};var o=(r=e("./isReactNative.js"))&&r.__esModule?r:{default:r}},{"./isReactNative.js":5}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;r.default=class{createRequest(e,t){return new o(e,t)}getName(){return"XHRHttpStack"}};class o{constructor(e,t){this._xhr=new XMLHttpRequest,this._xhr.open(e,t,!0),this._method=e,this._url=t,this._headers={}}getMethod(){return this._method}getURL(){return this._url}setHeader(e,t){this._xhr.setRequestHeader(e,t),this._headers[e]=t}getHeader(e){return this._headers[e]}setProgressHandler(t){"upload"in this._xhr&&(this._xhr.upload.onprogress=e=>{e.lengthComputable&&t(e.loaded)})}send(){let r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return new Promise((e,t)=>{this._xhr.onload=()=>{e(new s(this._xhr))},this._xhr.onerror=e=>{t(e)},this._xhr.send(r)})}abort(){return this._xhr.abort(),Promise.resolve()}getUnderlyingObject(){return this._xhr}}class s{constructor(e){this._xhr=e}getStatus(){return this._xhr.status}getHeader(e){return this._xhr.getResponseHeader(e)}getBody(){return this._xhr.responseText}getUnderlyingObject(){return this._xhr}}},{}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"DefaultHttpStack",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(r,"DetailedError",{enumerable:!0,get:function(){return n.default}}),r.Upload=void 0,Object.defineProperty(r,"canStoreURLs",{enumerable:!0,get:function(){return l.canStoreURLs}}),r.defaultOptions=void 0,Object.defineProperty(r,"enableDebugLog",{enumerable:!0,get:function(){return i.enableDebugLog}}),r.isSupported=void 0;var o=d(e("../upload.js")),s=d(e("../noopUrlStorage.js")),i=e("../logger.js"),n=d(e("../error.js")),l=e("./urlStorage.js"),a=d(e("./httpStack.js")),u=d(e("./fileReader.js")),e=d(e("./fileSignature.js"));function d(e){return e&&e.__esModule?e:{default:e}}const h=r.defaultOptions={...o.default.defaultOptions,httpStack:new a.default,fileReader:new u.default,urlStorage:new(l.canStoreURLs?l.WebStorageUrlStorage:s.default),fingerprint:e.default};class p extends o.default{constructor(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};super(e,{...h,...t})}static terminate(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},t={...h,...t};return o.default.terminate(e,t)}}r.Upload=p;r.isSupported="function"==typeof XMLHttpRequest&&"function"==typeof Blob&&"function"==typeof Blob.prototype.slice},{"../error.js":12,"../logger.js":13,"../noopUrlStorage.js":14,"../upload.js":15,"./fileReader.js":1,"./fileSignature.js":2,"./httpStack.js":3,"./urlStorage.js":11}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;r.default=()=>"undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase()},{}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var o=i(e("./isCordova.js")),s=i(e("./readAsByteArray.js"));function i(e){return e&&e.__esModule?e:{default:e}}r.default=class{constructor(e){this._file=e,this.size=e.size}slice(e,t){return(0,o.default)()?(0,s.default)(this._file.slice(e,t)):(e=this._file.slice(e,t),t=t>=this.size,Promise.resolve({value:e,done:t}))}close(){}}},{"./isCordova.js":8,"./readAsByteArray.js":9}],7:[function(e,t,r){"use strict";function s(e){return void 0===e?0:void 0!==e.size?e.size:e.length}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;r.default=class{constructor(e){this._buffer=void 0,this._bufferOffset=0,this._reader=e,this._done=!1}slice(e,t){return e<this._bufferOffset?Promise.reject(new Error("Requested data is before the reader's current offset")):this._readUntilEnoughDataOrDone(e,t)}_readUntilEnoughDataOrDone(r,o){var e,t=o<=this._bufferOffset+s(this._buffer);return this._done||t?(e=null==(t=this._getDataFromBuffer(r,o))&&this._done,Promise.resolve({value:t,done:e})):this._reader.read().then(e=>{var{value:e,done:t}=e;return t?this._done=!0:void 0===this._buffer?this._buffer=e:this._buffer=function(e,t){if(e.concat)return e.concat(t);if(e instanceof Blob)return new Blob([e,t],{type:e.type});var r;if(e.set)return(r=new e.constructor(e.length+t.length)).set(e),r.set(t,e.length),r;throw new Error("Unknown data type")}(this._buffer,e),this._readUntilEnoughDataOrDone(r,o)})}_getDataFromBuffer(e,t){e>this._bufferOffset&&(this._buffer=this._buffer.slice(e-this._bufferOffset),this._bufferOffset=e);var r=0===s(this._buffer);return this._done&&r?null:this._buffer.slice(0,t-e)}close(){this._reader.cancel&&this._reader.cancel()}}},{}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;r.default=()=>"undefined"!=typeof window&&(void 0!==window.PhoneGap||void 0!==window.Cordova||void 0!==window.cordova)},{}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){return new Promise((t,r)=>{const o=new FileReader;o.onload=()=>{var e=new Uint8Array(o.result);t({value:e})},o.onerror=e=>{r(e)},o.readAsArrayBuffer(e)})}},{}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){return new Promise((t,r)=>{const o=new XMLHttpRequest;o.responseType="blob",o.onload=()=>{var e=o.response;t(e)},o.onerror=e=>{r(e)},o.open("GET",e),o.send()})}},{}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.canStoreURLs=r.WebStorageUrlStorage=void 0;let o=!1;try{o="localStorage"in window;var s="tusSupport",i=localStorage.getItem(s);localStorage.setItem(s,i),null===i&&localStorage.removeItem(s)}catch(e){if(e.code!==e.SECURITY_ERR&&e.code!==e.QUOTA_EXCEEDED_ERR)throw e;o=!1}r.canStoreURLs=o;r.WebStorageUrlStorage=class{findAllUploads(){var e=this._findEntries("tus::");return Promise.resolve(e)}findUploadsByFingerprint(e){e=this._findEntries(`tus::${e}::`);return Promise.resolve(e)}removeUpload(e){return localStorage.removeItem(e),Promise.resolve()}addUpload(e,t){e=`tus::${e}::`+Math.round(1e12*Math.random());return localStorage.setItem(e,JSON.stringify(t)),Promise.resolve(e)}_findEntries(t){var r=[];for(let e=0;e<localStorage.length;e++){var o=localStorage.key(e);if(0===o.indexOf(t))try{var s=JSON.parse(localStorage.getItem(o));s.urlStorageKey=o,r.push(s)}catch(e){}}return r}}},{}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;class o extends Error{constructor(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;super(e),this.originalRequest=r,this.originalResponse=o,null!=(this.causingError=t)&&(e+=", caused by "+t.toString()),null!=r&&(t=r.getHeader("X-Request-ID")||"n/a",e+=`, originated from request (method: ${r.getMethod()}, url: ${r.getURL()}, response code: ${o?o.getStatus():"n/a"}, response text: ${o?o.getBody()||"":"n/a"}, request id: ${t})`),this.message=e}}r.default=o},{}],13:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.enableDebugLog=function(){o=!0};let o=!(r.log=function(e){o&&console.log(e)})},{}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;r.default=class{listAllUploads(){return Promise.resolve([])}findUploadsByFingerprint(e){return Promise.resolve([])}removeUpload(e){return Promise.resolve()}addUpload(e,t){return Promise.resolve(null)}}},{}],15:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=i(e("./error.js")),o=e("./logger.js"),s=i(e("./uuid.js"));function i(e){return e&&e.__esModule?e:{default:e}}const l="tus-v1",a="ietf-draft-03";e={endpoint:null,uploadUrl:null,metadata:{},fingerprint:null,uploadSize:null,onProgress:null,onChunkComplete:null,onSuccess:null,onError:null,onUploadUrlAvailable:null,overridePatchMethod:!1,headers:{},addRequestId:!1,onBeforeRequest:null,onAfterResponse:null,onShouldRetry:_,chunkSize:1/0,retryDelays:[0,1e3,3e3,5e3],parallelUploads:1,parallelUploadBoundaries:null,storeFingerprintForResuming:!0,removeFingerprintOnSuccess:!1,uploadLengthDeferred:!1,uploadDataDuringCreation:!1,urlStorage:null,fileReader:null,httpStack:null,protocol:l};class d{constructor(e,t){"resume"in t&&console.log("tus: The `resume` option has been removed in tus-js-client v2. Please use the URL storage API instead."),this.options=t,this.options.chunkSize=Number(this.options.chunkSize),this._urlStorage=this.options.urlStorage,this.file=e,this.url=null,this._req=null,this._fingerprint=null,this._urlStorageKey=null,this._offset=null,this._aborted=!1,this._size=null,this._source=null,this._retryAttempt=0,this._retryTimeout=null,this._offsetBeforeRetry=0,this._parallelUploads=null,this._parallelUploadUrls=null}static terminate(o){let s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};const i=u("DELETE",o,s);return f(i,null,s).then(e=>{if(204!==e.getStatus())throw new n.default("tus: unexpected response while terminating upload",null,i,e)}).catch(e=>{if(!c(e=e instanceof n.default?e:new n.default("tus: failed to terminate upload",e,i,null),0,s))throw e;const t=s.retryDelays[0];e=s.retryDelays.slice(1);const r={...s,retryDelays:e};return new Promise(e=>setTimeout(e,t)).then(()=>d.terminate(o,r))})}findPreviousUploads(){return this.options.fingerprint(this.file,this.options).then(e=>this._urlStorage.findUploadsByFingerprint(e))}resumeFromPreviousUpload(e){this.url=e.uploadUrl||null,this._parallelUploadUrls=e.parallelUploadUrls||null,this._urlStorageKey=e.urlStorageKey}start(){const t=this["file"];if(t)if([l,a].includes(this.options.protocol))if(this.options.endpoint||this.options.uploadUrl||this.url){var e=this.options["retryDelays"];if(null!=e&&"[object Array]"!==Object.prototype.toString.call(e))this._emitError(new Error("tus: the `retryDelays` option must either be an array or null"));else{if(1<this.options.parallelUploads)for(const r of["uploadUrl","uploadSize","uploadLengthDeferred"])if(this.options[r])return void this._emitError(new Error(`tus: cannot use the ${r} option when parallelUploads is enabled`));if(this.options.parallelUploadBoundaries){if(this.options.parallelUploads<=1)return void this._emitError(new Error("tus: cannot use the `parallelUploadBoundaries` option when `parallelUploads` is disabled"));if(this.options.parallelUploads!==this.options.parallelUploadBoundaries.length)return void this._emitError(new Error("tus: the `parallelUploadBoundaries` must have the same length as the value of `parallelUploads`"))}this.options.fingerprint(t,this.options).then(e=>(null==e?(0,o.log)("No fingerprint was calculated meaning that the upload cannot be stored in the URL storage."):(0,o.log)("Calculated fingerprint: "+e),this._fingerprint=e,this._source||this.options.fileReader.openFile(t,this.options.chunkSize))).then(e=>{if(this._source=e,this.options.uploadLengthDeferred)this._size=null;else if(null!=this.options.uploadSize){if(this._size=Number(this.options.uploadSize),Number.isNaN(this._size))return void this._emitError(new Error("tus: cannot convert `uploadSize` option into a number"))}else if(this._size=this._source.size,null==this._size)return void this._emitError(new Error("tus: cannot automatically derive upload's size from input. Specify it manually using the `uploadSize` option or use the `uploadLengthDeferred` option"));1<this.options.parallelUploads||null!=this._parallelUploadUrls?this._startParallelUpload():this._startSingleUpload()}).catch(e=>{this._emitError(e)})}}else this._emitError(new Error("tus: neither an endpoint or an upload URL is provided"));else this._emitError(new Error("tus: unsupported protocol "+this.options.protocol));else this._emitError(new Error("tus: no file or stream to upload provided"))}_startParallelUpload(){const l=this._size;let a=0;this._parallelUploads=[];var e=null!=this._parallelUploadUrls?this._parallelUploadUrls.length:this.options.parallelUploads;const u=this.options.parallelUploadBoundaries??function(e,t){var r=Math.floor(e/t),o=[];for(let e=0;e<t;e++)o.push({start:r*e,end:r*(e+1)});return o[t-1].end=e,o}(this._source.size,e);this._parallelUploadUrls&&u.forEach((e,t)=>{e.uploadUrl=this._parallelUploadUrls[t]||null}),this._parallelUploadUrls=new Array(u.length);e=u.map((s,i)=>{let n=0;return this._source.slice(s.start,s.end).then(e=>{let o=e["value"];return new Promise((e,t)=>{e={...this.options,uploadUrl:s.uploadUrl||null,storeFingerprintForResuming:!1,removeFingerprintOnSuccess:!1,parallelUploads:1,parallelUploadBoundaries:null,metadata:{},headers:{...this.options.headers,"Upload-Concat":"partial"},onSuccess:e,onError:t,onProgress:e=>{a=a-n+e,n=e,this._emitProgress(a,l)},onUploadUrlAvailable:()=>{this._parallelUploadUrls[i]=r.url,this._parallelUploadUrls.filter(e=>Boolean(e)).length===u.length&&this._saveUploadInUrlStorage()}};const r=new d(o,e);r.start(),this._parallelUploads.push(r)})})});let r;Promise.all(e).then(()=>{(r=this._openRequest("POST",this.options.endpoint)).setHeader("Upload-Concat","final;"+this._parallelUploadUrls.join(" "));var e=h(this.options.metadata);return""!==e&&r.setHeader("Upload-Metadata",e),this._sendRequest(r,null)}).then(e=>{var t;p(e.getStatus(),200)?null==(t=e.getHeader("Location"))?this._emitHttpError(r,e,"tus: invalid or missing Location header"):(this.url=g(this.options.endpoint,t),(0,o.log)("Created upload at "+this.url),this._emitSuccess()):this._emitHttpError(r,e,"tus: unexpected response while creating upload")}).catch(e=>{this._emitError(e)})}_startSingleUpload(){this._aborted=!1,null!=this.url?((0,o.log)("Resuming upload from previous URL: "+this.url),this._resumeUpload()):null!=this.options.uploadUrl?((0,o.log)("Resuming upload from provided URL: "+this.options.uploadUrl),this.url=this.options.uploadUrl,this._resumeUpload()):((0,o.log)("Creating a new upload"),this._createUpload())}abort(t){return null!=this._parallelUploads&&this._parallelUploads.forEach(e=>{e.abort(t)}),null!==this._req&&this._req.abort(),this._aborted=!0,null!=this._retryTimeout&&(clearTimeout(this._retryTimeout),this._retryTimeout=null),t&&null!=this.url?d.terminate(this.url,this.options).then(()=>this._removeFromUrlStorage()):Promise.resolve()}_emitHttpError(e,t,r,o){this._emitError(new n.default(r,o,e,t))}_emitError(e){if(!this._aborted){var t;if(null!=this.options.retryDelays)if(null!=this._offset&&this._offset>this._offsetBeforeRetry&&(this._retryAttempt=0),c(e,this._retryAttempt,this.options))return t=this.options.retryDelays[this._retryAttempt++],this._offsetBeforeRetry=this._offset,void(this._retryTimeout=setTimeout(()=>{this.start()},t));if("function"!=typeof this.options.onError)throw e;this.options.onError(e)}}_emitSuccess(){this.options.removeFingerprintOnSuccess&&this._removeFromUrlStorage(),"function"==typeof this.options.onSuccess&&this.options.onSuccess()}_emitProgress(e,t){"function"==typeof this.options.onProgress&&this.options.onProgress(e,t)}_emitChunkComplete(e,t,r){"function"==typeof this.options.onChunkComplete&&this.options.onChunkComplete(e,t,r)}_createUpload(){if(this.options.endpoint){const r=this._openRequest("POST",this.options.endpoint);this.options.uploadLengthDeferred?r.setHeader("Upload-Defer-Length",1):r.setHeader("Upload-Length",this._size);var t=h(this.options.metadata);""!==t&&r.setHeader("Upload-Metadata",t);let e;(e=this.options.uploadDataDuringCreation&&!this.options.uploadLengthDeferred?(this._offset=0,this._addChunkToRequest(r)):(this.options.protocol===a&&r.setHeader("Upload-Complete","?0"),this._sendRequest(r,null))).then(e=>{var t;p(e.getStatus(),200)?null==(t=e.getHeader("Location"))?this._emitHttpError(r,e,"tus: invalid or missing Location header"):(this.url=g(this.options.endpoint,t),(0,o.log)("Created upload at "+this.url),"function"==typeof this.options.onUploadUrlAvailable&&this.options.onUploadUrlAvailable(),0===this._size?(this._emitSuccess(),this._source.close()):this._saveUploadInUrlStorage().then(()=>{this.options.uploadDataDuringCreation?this._handleUploadResponse(r,e):(this._offset=0,this._performUpload())})):this._emitHttpError(r,e,"tus: unexpected response while creating upload")}).catch(e=>{this._emitHttpError(r,null,"tus: failed to create upload",e)})}else this._emitError(new Error("tus: unable to create upload because no endpoint is provided"))}_resumeUpload(){const s=this._openRequest("HEAD",this.url);this._sendRequest(s,null).then(e=>{var t=e.getStatus();if(!p(t,200))return 423===t?void this._emitHttpError(s,e,"tus: upload is currently locked; retry later"):(p(t,400)&&this._removeFromUrlStorage(),this.options.endpoint?(this.url=null,void this._createUpload()):void this._emitHttpError(s,e,"tus: unable to resume upload (new upload cannot be created without an endpoint)"));const r=parseInt(e.getHeader("Upload-Offset"),10);if(Number.isNaN(r))this._emitHttpError(s,e,"tus: invalid or missing offset value");else{const o=parseInt(e.getHeader("Upload-Length"),10);Number.isNaN(o)&&!this.options.uploadLengthDeferred&&this.options.protocol===l?this._emitHttpError(s,e,"tus: invalid or missing length value"):("function"==typeof this.options.onUploadUrlAvailable&&this.options.onUploadUrlAvailable(),this._saveUploadInUrlStorage().then(()=>{r===o?(this._emitProgress(o,o),this._emitSuccess()):(this._offset=r,this._performUpload())}))}}).catch(e=>{this._emitHttpError(s,null,"tus: failed to resume upload",e)})}_performUpload(){if(!this._aborted){let t;this.options.overridePatchMethod?(t=this._openRequest("POST",this.url)).setHeader("X-HTTP-Method-Override","PATCH"):t=this._openRequest("PATCH",this.url),t.setHeader("Upload-Offset",this._offset),this._addChunkToRequest(t).then(e=>{p(e.getStatus(),200)?this._handleUploadResponse(t,e):this._emitHttpError(t,e,"tus: unexpected response while uploading chunk")}).catch(e=>{this._aborted||this._emitHttpError(t,null,"tus: failed to upload chunk at offset "+this._offset,e)})}}_addChunkToRequest(o){const t=this._offset;let e=this._offset+this.options.chunkSize;return o.setProgressHandler(e=>{this._emitProgress(t+e,this._size)}),o.setHeader("Content-Type","application/offset+octet-stream"),(e===1/0||e>this._size)&&!this.options.uploadLengthDeferred&&(e=this._size),this._source.slice(t,e).then(e=>{var{value:e,done:t}=e,r=e&&e.size?e.size:0,r=(this.options.uploadLengthDeferred&&t&&(this._size=this._offset+r,o.setHeader("Upload-Length",this._size)),this._offset+r);return!this.options.uploadLengthDeferred&&t&&r!==this._size?Promise.reject(new Error(`upload was configured with a size of ${this._size} bytes, but the source is done after ${r} bytes`)):null===e?this._sendRequest(o):(this.options.protocol===a&&o.setHeader("Upload-Complete",t?"?1":"?0"),this._emitProgress(this._offset,this._size),this._sendRequest(o,e))})}_handleUploadResponse(e,t){var r=parseInt(t.getHeader("Upload-Offset"),10);Number.isNaN(r)?this._emitHttpError(e,t,"tus: invalid or missing offset value"):(this._emitProgress(r,this._size),this._emitChunkComplete(r-this._offset,r,this._size),(this._offset=r)===this._size?(this._emitSuccess(),this._source.close()):this._performUpload())}_openRequest(e,t){e=u(e,t,this.options);return this._req=e}_removeFromUrlStorage(){this._urlStorageKey&&(this._urlStorage.removeUpload(this._urlStorageKey).catch(e=>{this._emitError(e)}),this._urlStorageKey=null)}_saveUploadInUrlStorage(){var e;return this.options.storeFingerprintForResuming&&this._fingerprint&&null===this._urlStorageKey?(e={size:this._size,metadata:this.options.metadata,creationTime:(new Date).toString()},this._parallelUploads?e.parallelUploadUrls=this._parallelUploadUrls:e.uploadUrl=this.url,this._urlStorage.addUpload(this._fingerprint,e).then(e=>{this._urlStorageKey=e})):Promise.resolve()}_sendRequest(e){return f(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,this.options)}}function h(e){return Object.entries(e).map(e=>{var[e,t]=e;return e+" "+btoa(String(t))}).join(",")}function p(e,t){return t<=e&&e<t+100}function u(e,t,r){const o=r.httpStack.createRequest(e,t);r.protocol===a?o.setHeader("Upload-Draft-Interop-Version","5"):o.setHeader("Tus-Resumable","1.0.0");e=r.headers||{};return Object.entries(e).forEach(e=>{var[e,t]=e;o.setHeader(e,t)}),r.addRequestId&&(t=(0,s.default)(),o.setHeader("X-Request-ID",t)),o}async function f(e,t,r){"function"==typeof r.onBeforeRequest&&await r.onBeforeRequest(e);t=await e.send(t);return"function"==typeof r.onAfterResponse&&await r.onAfterResponse(e,t),t}function c(e,t,r){return!(null==r.retryDelays||t>=r.retryDelays.length||null==e.originalRequest)&&(r&&"function"==typeof r.onShouldRetry?r.onShouldRetry(e,t,r):_(e))}function _(e){e=e.originalResponse?e.originalResponse.getStatus():0;return(!p(e,400)||409===e||423===e)&&function(){let e=!0;return e="undefined"!=typeof navigator&&!1===navigator.onLine?!1:e}()}function g(e,t){return new URL(t,e).toString()}d.defaultOptions=e;r.default=d},{"./error.js":12,"./logger.js":13,"./uuid.js":16}],16:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}},{}]},{},[4])(4)});
//# sourceMappingURL=tus.min.js.map